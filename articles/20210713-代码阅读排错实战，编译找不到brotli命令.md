# 代码阅读排错实战：编译Android找不到brotli命令

## 背景

这是一类非常常见的错误，编译代码或执行程序时出错，通常的错误信息就是找不到文件/命令，或命令执行失败。

对这一类”找不到xxx"或“xxx执行失败"问题的排错是有规律的，所以本文不仅仅是分析解决"找不到brotli命令"这个问题本身，更是提供解决这一类问题的通用思路。

对有经验的老油条来说，这个问题会很简单，但对一些刚毕业或工作时间较短的朋友们来说，可能会觉得无从下手。

根据我自己过往的经验(谁还不是从没啥经验摸索过来的啊~)，无从下手，可能有类似这样的原因:

1. 刚接触Android，对Android编译系统不熟悉；
2. 以前从来没有用过brotli命令，不知道这个命名是做什么的；
3. 不清楚代码中调用brotli命令来做什么；

这里常常有一个心里活动，就是这一切对我来说都是未知的，一种面对未知的恐惧潜藏在心底，所以会有感觉搞不定的自我暗示，因为不了解。

回到之前谈过的，[程序出错了，第一件事要做什么？](20210703-程序出错了，第一件事要做什么？.md)，虽然Android不熟悉，虽然brotli不熟悉，但出错的具体信息可能很熟悉。
这里我没有让小伙伴贴出错误信息，但从他的描述看，”找不到brotli命令"，有没有觉得这样的错误很熟悉，类似的错误还有：
- "No such file or directory"
- "No such command"
- "Execute xxx failed, can't find xxx"
- "No permissions"

所以，系统再陌生，再复杂，但出现的错误可能是熟悉的。

实际上，调试问题棘手的不是出错，棘手的是错了错误却没有错误信息(比如突然duang~ segmentation fault了)，更棘手的是感觉有些地方不对劲，但系统并没有出错(各种启动和运行的性能问题)。

这就好像你老板不喜欢你，说你xxx做得不好一样，这其实是比较好的情况，因为知道了原因你还可以改进。坏的情况就是，老板说你工作做得不好，你问哪里做得不好，他就是不告诉你。更惨的是，感觉平时和老板相处得还行，你问他你的工作怎样，他说还不错，做得挺好，但考勤时你总是垫底。你说咋整？

所以，困难的不是错误，困难的是没有反馈。

## 分析错误

回到这个问题，错误信息是"找不到brotli命令"，我们就来看看下一步要怎么办？

第一步当然是核实看到底有没有brotli这个东西，如果有，那在哪里？

如果你非要问我为什么要再去核实有没有brotli？因为错误信息明明白白说了“找不到brotli命令"，那就是没有啊。我只想说，之所以第一步要去核实，那时因为常常会有意外，来到错误的原点，先重复一下错误，会大大减少意外的发生。没有啥，血和泪的经历，当你经历了足够多错误的时候就明白了。

确认一个文件是否存在，find命令就该出场了，因为Android系统是自包含的，基本上所有的工具和命令都包含在自己的代码包里，然后在编译时统一输出到out目录，所以尝试在out目录中查找下brotli:
```
find out -type f -name brotli 2>/dev/null
```

接下来根据find的结果决定第二步的操作:
- 如果找到了，那就检查编译脚本的运行环境，为什么找不到这个已经存在的brotli文件？
- 如果没有找到，那就检查编译的设置，为什么没有生成brotli?

小伙伴反应的是，brotli相关的动态库有，但没有生成brotli命令本身。

所以，接下来就应该找到brotli的源码目录，检查brotli的编译。以前没有了解过brotli？哪里去找brotli的代码呢？此时find命令再次上场:
```
find system external -type d -name brotli 2>/dev/null
```
根据惯例，Android的一些工具命令什么的通常放在system或external目录下，那就去搜索名为brotli的目录。

> 需要改进的是，brotli工具的源码目录不一定刚好叫brotli，所以搜索名字包含brotli的目录会更好:
> ```
> find system external -type d -name "*brotli*" 2>/dev/null
> ```

找到了我们就打开对应的编译命令看下吧:
```

```

## 解决思路

## 错误扩展

